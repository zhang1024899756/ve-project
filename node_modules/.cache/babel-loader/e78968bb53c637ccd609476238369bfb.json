{"ast":null,"code":"var _jsxFileName = \"/Users/zhangxinyu/Desktop/ve_project/src/components/jtopo-canvas.js\";\nimport React from 'react';\n//import Interface from './interface';\nimport Windows20008 from './win_2008';\nexport default class JtopoCanvas extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      scene: null,\n      currentNode: null,\n      beginNode: null,\n      temp: {\n        tempNodeA: null,\n        tempNodeZ: null,\n        link: null\n      },\n      showMenu: {\n        ifShow: false,\n        x: 0,\n        y: 0\n      },\n      interface: false,\n      nodes: []\n    };\n  }\n\n  _handler(event) {\n    if (event.button == 2) {\n      this.setState({\n        showMenu: {\n          ifShow: true,\n          x: event.pageX - 220,\n          y: event.pageY - 140\n        }\n      });\n    }\n  }\n\n  _clickMenu(e) {\n    const btn = e.target.innerHTML;\n\n    if (btn == '连接设备') {\n      if (this.state.beginNode == null) {\n        this.setState({\n          beginNode: this.state.currentNode\n        });\n        this.state.scene.add(this.state.temp.link);\n        this.state.temp.tempNodeA.setLocation(this.state.currentNode.x, this.state.currentNode.y);\n        this.state.temp.tempNodeZ.setLocation(this.state.currentNode.x, this.state.currentNode.y);\n      }\n    }\n\n    if (btn == '操作界面') {\n      this.setState({\n        interface: true\n      });\n    }\n\n    if (btn == '删除设备') {\n      this.state.nodes.splice(this.state.currentNode._id, 1);\n      this.state.scene.remove(this.state.currentNode);\n      this.setState({\n        currentNode: null\n      });\n    }\n\n    this.setState({\n      showMenu: {\n        ifShow: false,\n        x: 0,\n        y: 0\n      }\n    });\n  }\n\n  componentDidMount() {\n    const canvas = document.getElementById('canvas');\n    const stage = new JTopo.Stage(canvas);\n    const scene = new JTopo.Scene(stage); //定义两个临时节点，一条临时线段\n\n    const tempNodeA = new JTopo.Node('tempA');\n    tempNodeA.setSize(1, 1);\n    const tempNodeZ = new JTopo.Node('tempZ');\n    tempNodeZ.setSize(1, 1);\n    const link = new JTopo.Link(tempNodeA, tempNodeZ);\n    this.setState({\n      temp: {\n        tempNodeA: tempNodeA,\n        tempNodeZ: tempNodeZ,\n        link: link\n      }\n    }); //在link原型上封装一个添加节点方法用来显示删除连线按钮\n\n    JTopo.Link.prototype.addcenternode = thisL => {\n      thisL.cnode = new JTopo.CircleNode('X');\n      thisL.cnode.radius = 5;\n      thisL.cnode.fillColor = '0,0,0';\n      thisL.cnode.textPosition = 'Middle_Center';\n      scene.add(thisL.cnode);\n      thisL.cnode.addEventListener('click', () => {\n        scene.remove(thisL);\n        scene.remove(thisL.cnode);\n      });\n    };\n\n    stage.addEventListener('click', event => {\n      if (event.button == 0) {\n        this.setState({\n          showMenu: {\n            ifShow: false,\n            x: 0,\n            y: 0\n          }\n        });\n      }\n    });\n    scene.addEventListener('mouseup', event => {\n      if (event.button == 2) {\n        this.state.scene.remove(this.state.temp.link);\n        return;\n      }\n\n      if (event.target !== null && event.target instanceof JTopo.Node) {\n        if (this.state.beginNode !== event.target) {\n          let endNode = event.target;\n          let l = new JTopo.Link(this.state.beginNode, endNode);\n          this.state.scene.add(l);\n          this.setState({\n            beginNode: null\n          });\n          this.state.scene.remove(this.state.temp.link);\n        } else {\n          this.setState({\n            beginNode: null\n          });\n        }\n      } else {\n        this.state.scene.remove(this.state.temp.link);\n      }\n    });\n    scene.addEventListener('mousedown', event => {\n      if (event.target == null || event.target == this.state.beginNode || event.target == this.state.temp.link) {\n        this.state.scene.remove(this.state.temp.link);\n      }\n    });\n    scene.addEventListener('mousemove', event => {\n      this.state.temp.tempNodeZ.setLocation(event.x, event.y);\n    });\n    scene.addEventListener('dbclick', event => {\n      const thisL = event.target;\n\n      if (thisL.elementType == 'link') {\n        thisL.addcenternode(thisL);\n\n        thisL.paintPath = (a, b) => {\n          if (thisL.cnode) {\n            thisL.cnode.cx = thisL.nodeA.cx + (thisL.nodeZ.cx - thisL.nodeA.cx) / 2;\n            thisL.cnode.cy = thisL.nodeA.cy + (thisL.nodeZ.cy - thisL.nodeA.cy) / 2;\n          }\n\n          if (thisL.nodeA === thisL.nodeZ) return void thisL.paintLoop(a);\n          a.beginPath(), a.moveTo(b[0].x, b[0].y);\n\n          for (let c = 1; c < b.length; c++) {\n            null == thisL.dashedPattern ? null == thisL.PointPathColor ? a.lineTo(b[c].x, b[c].y) : a.JtopoDrawPointPath(b[c - 1].x, b[c - 1].y, b[c].x, b[c].y, a.strokeStyle, thisL.PointPathColor) : a.JTopoDashedLineTo(b[c - 1].x, b[c - 1].y, b[c].x, b[c].y, thisL.dashedPattern);\n          }\n\n          if (a.stroke(), a.closePath(), null != thisL.arrowsRadius) {\n            let d = b[b.length - 2];\n            let e = b[b.length - 1];\n            thisL.paintArrow(a, d, e);\n          }\n        };\n\n        thisL.addEventListener('click', () => {\n          if (thisL.cnode) {\n            scene.remove(thisL.cnode);\n          }\n        });\n      }\n    });\n    this.setState({\n      scene: scene\n    });\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.canvasNode !== null) {\n      let newnode = nextProps.canvasNode;\n      let node = new JTopo.Node(newnode.name);\n      node.setImage(newnode.images[0], true);\n      node.setLocation(Math.random() * 200 + 10, Math.random() * 200 + 10);\n      node.compProps = newnode;\n      this.state.scene.add(node);\n      this.state.nodes.push(node);\n      node.addEventListener('mouseup', event => {\n        this.setState({\n          currentNode: node\n        });\n\n        this._handler(event);\n      });\n    }\n  }\n\n  render() {\n    const _style = {\n      canvas: {\n        background: '#5F9EA0',\n        margin: '0 auto'\n      },\n      menu: {\n        width: '80px',\n        padding: '5px',\n        position: 'absolute',\n        background: '#eee',\n        listStyle: 'none',\n        left: this.state.showMenu.x + 'px',\n        top: this.state.showMenu.y + 'px'\n      }\n    };\n    const menu = React.createElement(\"ul\", {\n      style: _style.menu,\n      onClick: this._clickMenu.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170\n      },\n      __self: this\n    }, React.createElement(\"li\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }, \"\\u8BBE\\u5907\\u7535\\u6E90\"), React.createElement(\"li\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    }, \"\\u8FDE\\u63A5\\u8BBE\\u5907\"), React.createElement(\"li\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173\n      },\n      __self: this\n    }, \"\\u64CD\\u4F5C\\u754C\\u9762\"), React.createElement(\"li\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }, \"\\u5220\\u9664\\u8BBE\\u5907\"));\n\n    if (this.state.interface == true) {\n      return React.createElement(Windows20008, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      });\n    }\n\n    return React.createElement(\"div\", {\n      style: {\n        textAlign: 'center'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181\n      },\n      __self: this\n    }, React.createElement(\"canvas\", {\n      style: _style.canvas,\n      id: \"canvas\",\n      width: \"800\",\n      height: \"500\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    }), this.state.showMenu.ifShow && menu);\n  }\n\n}","map":{"version":3,"sources":["/Users/zhangxinyu/Desktop/ve_project/src/components/jtopo-canvas.js"],"names":["React","Windows20008","JtopoCanvas","Component","constructor","state","scene","currentNode","beginNode","temp","tempNodeA","tempNodeZ","link","showMenu","ifShow","x","y","interface","nodes","_handler","event","button","setState","pageX","pageY","_clickMenu","e","btn","target","innerHTML","add","setLocation","splice","_id","remove","componentDidMount","canvas","document","getElementById","stage","JTopo","Stage","Scene","Node","setSize","Link","prototype","addcenternode","thisL","cnode","CircleNode","radius","fillColor","textPosition","addEventListener","endNode","l","elementType","paintPath","a","b","cx","nodeA","nodeZ","cy","paintLoop","beginPath","moveTo","c","length","dashedPattern","PointPathColor","lineTo","JtopoDrawPointPath","strokeStyle","JTopoDashedLineTo","stroke","closePath","arrowsRadius","d","paintArrow","componentWillReceiveProps","nextProps","canvasNode","newnode","node","name","setImage","images","Math","random","compProps","push","render","_style","background","margin","menu","width","padding","position","listStyle","left","top","bind","textAlign"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Layout, Menu, Icon, Row, Col, Button, List, Spin, Avatar } from 'antd';\n//import Interface from './interface';\nimport Windows20008 from './win_2008';\n\n\nexport default class JtopoCanvas extends React.Component {\n  constructor() {\n\t\tsuper();\n\t\tthis.state = {\n      scene: null,\n      currentNode: null,\n      beginNode: null,\n      temp: {tempNodeA: null,tempNodeZ: null,link: null},\n      showMenu: {ifShow: false,x: 0,y: 0},\n      interface: false,\n      nodes: []\n\t\t};\n  };\n\n  _handler (event) {\n    if (event.button == 2) {\n      this.setState({\n        showMenu: {ifShow: true,x: event.pageX - 220,y: event.pageY - 140}\n      })\n    }\n  }\n  _clickMenu (e) {\n    const btn = e.target.innerHTML;\n    if (btn == '连接设备') {\n      if (this.state.beginNode == null) {\n        this.setState({beginNode:this.state.currentNode});\n        this.state.scene.add(this.state.temp.link);\n        this.state.temp.tempNodeA.setLocation(this.state.currentNode.x,this.state.currentNode.y);\n        this.state.temp.tempNodeZ.setLocation(this.state.currentNode.x,this.state.currentNode.y);\n      }\n    }\n    if (btn == '操作界面') {\n      this.setState({interface: true});\n    }\n    if (btn == '删除设备') {\n      this.state.nodes.splice(this.state.currentNode._id,1);\n      this.state.scene.remove(this.state.currentNode);\n      this.setState({currentNode: null});\n    }\n    this.setState({showMenu:{ifShow: false,x: 0,y: 0}});\n  }\n\n  componentDidMount () {\n\n    const canvas = document.getElementById('canvas');\n    const stage = new JTopo.Stage(canvas);\n    const scene = new JTopo.Scene(stage);\n\n    //定义两个临时节点，一条临时线段\n    const tempNodeA = new JTopo.Node('tempA')\n    tempNodeA.setSize(1, 1)\n    const tempNodeZ = new JTopo.Node('tempZ')\n    tempNodeZ.setSize(1, 1)\n    const link = new JTopo.Link(tempNodeA, tempNodeZ)\n    this.setState({temp: {tempNodeA: tempNodeA,tempNodeZ: tempNodeZ,link: link}})\n    //在link原型上封装一个添加节点方法用来显示删除连线按钮\n    JTopo.Link.prototype.addcenternode = (thisL) => {\n        thisL.cnode = new JTopo.CircleNode('X')\n        thisL.cnode.radius = 5\n        thisL.cnode.fillColor = '0,0,0'\n        thisL.cnode.textPosition = 'Middle_Center'\n        scene.add(thisL.cnode);\n        thisL.cnode.addEventListener('click',() => {\n          scene.remove(thisL);\n          scene.remove(thisL.cnode);\n        })\n    }\n\n    stage.addEventListener('click',(event) => {\n      if (event.button == 0) {\n        this.setState({showMenu:{ifShow: false,x: 0,y: 0}})\n      }\n    })\n    scene.addEventListener('mouseup',(event) => {\n      if (event.button == 2) {\n        this.state.scene.remove(this.state.temp.link);\n        return;\n      }\n      if (event.target !== null && event.target instanceof JTopo.Node) {\n        if (this.state.beginNode !== event.target) {\n          let endNode = event.target;\n          let l = new JTopo.Link(this.state.beginNode,endNode);\n          this.state.scene.add(l);\n          this.setState({beginNode: null});\n          this.state.scene.remove(this.state.temp.link);\n        } else {\n          this.setState({beginNode: null});\n        }\n      } else {\n        this.state.scene.remove(this.state.temp.link);\n      }\n    })\n    scene.addEventListener('mousedown',(event) => {\n      if (event.target == null || event.target == this.state.beginNode || event.target == this.state.temp.link) {\n        this.state.scene.remove(this.state.temp.link);\n      }\n    })\n    scene.addEventListener('mousemove',(event) => {\n      this.state.temp.tempNodeZ.setLocation(event.x,event.y);\n    })\n    scene.addEventListener('dbclick',(event) => {\n      const thisL = event.target;\n      if (thisL.elementType == 'link') {\n        thisL.addcenternode(thisL);\n        thisL.paintPath = (a, b) => {\n          if (thisL.cnode) {\n              thisL.cnode.cx = thisL.nodeA.cx + (thisL.nodeZ.cx - thisL.nodeA.cx) / 2;\n              thisL.cnode.cy = thisL.nodeA.cy + (thisL.nodeZ.cy - thisL.nodeA.cy) / 2;\n          }\n          if (thisL.nodeA === thisL.nodeZ) return void thisL.paintLoop(a);\n          a.beginPath(),\n          a.moveTo(b[0].x, b[0].y);\n          for (let c = 1; c < b.length; c++) {\n              null == thisL.dashedPattern ? (\n                  (null == thisL.PointPathColor ? a.lineTo(b[c].x, b[c].y) : a.JtopoDrawPointPath(b[c - 1].x, b[c - 1].y, b[c].x, b[c].y, a.strokeStyle, thisL.PointPathColor))\n              ) : a.JTopoDashedLineTo(b[c - 1].x, b[c - 1].y, b[c].x, b[c].y, thisL.dashedPattern)\n          }\n          if (a.stroke(), a.closePath(), null != thisL.arrowsRadius) {\n              let d = b[b.length - 2];\n              let e = b[b.length - 1];\n              thisL.paintArrow(a, d, e)\n          }\n        }\n        thisL.addEventListener('click',() => {\n          if (thisL.cnode) {\n              scene.remove(thisL.cnode);\n          }\n        })\n      }\n    })\n\n    this.setState({scene:scene})\n  }\n\n  componentWillReceiveProps (nextProps) {\n      if (nextProps.canvasNode !== null) {\n        let newnode = nextProps.canvasNode\n        let node = new JTopo.Node(newnode.name);\n        node.setImage(newnode.images[0],true)\n        node.setLocation(Math.random()*200 + 10,Math.random()*200 + 10);\n        node.compProps = newnode;\n        this.state.scene.add(node);\n        this.state.nodes.push(node)\n        node.addEventListener('mouseup',(event) => {\n          this.setState({currentNode:node})\n          this._handler(event)\n        })\n      }\n  }\n  render () {\n    const _style = {\n      canvas: {background: '#5F9EA0',margin:'0 auto'},\n      menu: {\n        width: '80px',\n        padding: '5px',\n        position: 'absolute',\n        background: '#eee',\n        listStyle: 'none',\n        left: this.state.showMenu.x + 'px',\n        top: this.state.showMenu.y + 'px'\n      }\n    }\n    const menu = (\n      <ul style={_style.menu} onClick={this._clickMenu.bind(this)}>\n        <li>设备电源</li>\n        <li>连接设备</li>\n        <li>操作界面</li>\n        <li>删除设备</li>\n      </ul>\n    );\n    if (this.state.interface == true) {\n      return(<Windows20008 />);\n    }\n    return(\n      <div style={{textAlign:'center'}}>\n        <canvas style={_style.canvas} id=\"canvas\" width=\"800\" height=\"500\"></canvas>\n        {this.state.showMenu.ifShow && menu}\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}