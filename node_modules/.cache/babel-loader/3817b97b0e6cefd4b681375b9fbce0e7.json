{"ast":null,"code":"'use strict';\n\nvar getError = function getError(options, xhr) {\n  var msg = 'cannot post ' + options.url + \":\" + xhr.status;\n  var err = new Error(msg);\n  err.status = xhr.status;\n  err.method = 'post';\n  err.url = options.url;\n  return err;\n};\n\nvar getBody = function getBody(xhr) {\n  var text = xhr.responseText || xhr.response;\n\n  if (!text) {\n    return text;\n  }\n\n  try {\n    return JSON.parse(text);\n  } catch (e) {\n    return text;\n  }\n};\n\nvar Uploader = {\n  post: function post(options) {\n    if (typeof XMLHttpRequest === 'undefined') {\n      return;\n    }\n\n    var xhr = new XMLHttpRequest();\n\n    if (xhr.upload) {\n      xhr.upload.onprogress = function (e) {\n        if (e.total > 0) {\n          e.percent = e.loaded / e.total * 100;\n        }\n\n        options.onLoad(e);\n      };\n    }\n\n    var formData = new FormData();\n\n    if (options.data) {\n      for (var i in options.data) {\n        formData.append(i, options.data[i]);\n      }\n    }\n\n    formData.append(options.filename, options.file);\n\n    xhr.onerror = function (e) {\n      options.onEnd(e);\n      options.onError(e);\n    };\n\n    xhr.onload = function (e) {\n      if (xhr.status !== 200) {\n        options.onEnd(e);\n        return options.onError(getError(options, xhr), getBody(xhr));\n      }\n\n      options.onEnd(e);\n      options.onSuccess(getBody(xhr));\n    };\n\n    xhr.open('post', options.url, true);\n    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n    xhr.send(formData);\n  }\n};\nmodule.exports = {\n  uploadFile: function uploadFile(options) {\n    options.url = options.url || \"/upload\";\n    options.filename = options.filename || \"file\";\n\n    options.beforeUpload = options.beforeUpload || function (e) {\n      return true;\n    };\n\n    options.onSuccess = options.onSuccess || function (e) {};\n\n    options.onError = options.onError || function (e) {};\n\n    options.onLoad = options.onLoad || function (e) {};\n\n    options.onStart = options.onStart || function (e) {};\n\n    options.onEnd = options.onEnd || function (e) {};\n\n    if (options.beforeUpload(options)) {\n      options.onStart(options); // 开始上传文件\n\n      Uploader.post(options);\n    }\n  },\n  uploadFiles: function uploadFiles(options) {}\n};","map":null,"metadata":{},"sourceType":"script"}